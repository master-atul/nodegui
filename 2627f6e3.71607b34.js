(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{133:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return d}));var o=n(2),a=n(6),r=(n(0),n(472)),i={sidebar_label:"Architecture",title:"Architecture"},s={unversionedId:"guides/nodegui-architecture",id:"guides/nodegui-architecture",isDocsHomePage:!1,title:"Architecture",description:"By looking at how NodeGui works internally, we would get a clear picture on why the APIs are designed the way they are.",source:"@site/docs/guides/nodegui-architecture.md",slug:"/guides/nodegui-architecture",permalink:"/docs/guides/nodegui-architecture",editUrl:"https://github.com/nodegui/nodegui/edit/master/website/docs/guides/nodegui-architecture.md",version:"current",sidebar_label:"Architecture",sidebar:"guides",previous:{title:"Helpful links",permalink:"/docs/guides/helpful-links"},next:{title:"Debugging",permalink:"/docs/guides/debugging"}},c=[{value:"Qode",id:"qode",children:[]},{value:"Using NodeGui APIs",id:"using-nodegui-apis",children:[]},{value:"Using Nodejs APIs",id:"using-nodejs-apis",children:[]}],l={rightToc:c};function d(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"By looking at how NodeGui works internally, we would get a clear picture on why the APIs are designed the way they are."),Object(r.b)("h2",{id:"qode"},"Qode"),Object(r.b)("p",null,"NodeGui uses Qt for creating Windows and other UI elements. Hence it exports thin wrappers of native C++ widgets from Qt into Javascript world. Now, every Qt application needs to initialize an instance of ",Object(r.b)("inlineCode",{parentName:"p"},"QApplication")," before creating widgets. The way we do it in C++ Qt application is (dont worry if it doesnt make sense right now):"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-cpp"}),' #include <QApplication>\n #include <QPushButton>\n\n int main(int argc, char *argv[])\n {\n     QApplication app(argc, argv); // Important\n\n     QPushButton hello("Hello world!");\n     hello.resize(100, 30);\n     hello.show();\n\n     return app.exec(); // Important\n }\n')),Object(r.b)("p",null,"Like many Gui libraries Qt uses an event/message loop to handle events from widgets. Hence, when we call ",Object(r.b)("inlineCode",{parentName:"p"},"app.exec()")," Qt starts its message loop and blocks on that line. This is all good when there is only one message loop in the entire app. But since we want to use Qt with NodeJS and NodeJs has its own event loop, we cannot run both Qt and NodeJs on the same thread easily."),Object(r.b)("p",null,"Then following questions arise:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"What if we run Qt on a separate thread?")," : No this is not possible since Qt has a requirement that it needs to run on the main thread."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"What if we run Node on a separate thread?")," : This would mean we need to build a complex bridge between Node and Qt threads to make them communicate. A strict no no.")),Object(r.b)("p",null,"So in order to make both NodeJs and Qt work together we need to find a way to merge these two event loops into one. This is achieved by a custom NodeJs binary we call as ",Object(r.b)("inlineCode",{parentName:"p"},"Qode"),"."),Object(r.b)("p",null,"Qode is a lightly modified fork of Node.js that merges Node's event loop with Qt's event loop. The idea of merging event loops is inspired by Electron and ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/yue"}),"other")," Gui libraries developed by ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/zcbenz"}),"zcbenz (Cheng Zhao)"),". It has been detailed in a post here: ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://electronjs.org/blog/electron-internals-node-integration"}),"Electron internals"),". Hence, we reused the logic from electron to achieve smooth integration between Qt and NodeJs."),Object(r.b)("p",null,"The idea is to release a corresponding Qode binary for every NodeJs version that comes out after Node v12.6.\nThe source code of Qode can be found ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/nodegui/qode"}),"here"),"."),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},"*","PS: Qode is a fork of ",Object(r.b)("a",Object(o.a)({parentName:"em"},{href:"https://github.com/yue/yode"}),"Yode"))),Object(r.b)("h2",{id:"using-nodegui-apis"},"Using NodeGui APIs"),Object(r.b)("p",null,"NodeGui offers a number of APIs that support the development of a desktop\napplication. You'd access NodeGui's APIs by requiring its included module:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-javascript"}),'require("@nodegui/nodegui");\n')),Object(r.b)("p",null,"A window in NodeGui is for instance created using the ",Object(r.b)("inlineCode",{parentName:"p"},"QMainWindow"),"\nclass."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-javascript"}),'const { QMainWindow } = require("@nodegui/nodegui");\n\nconst win = new QMainWindow();\n')),Object(r.b)("h2",{id:"using-nodejs-apis"},"Using Nodejs APIs"),Object(r.b)("p",null,"NodeGui exposes full access to Node.js. This has two important implications:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"All APIs available in Node.js are available in NodeGui. Calling the\nfollowing code from an NodeGui app works:")),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-javascript"}),"const fs = require(\"fs\");\n\nconst root = fs.readdirSync(\"/\");\n\n// This will print all files at the root-level of the disk,\n// either '/' or 'C:\\'.\nconsole.log(root);\n")),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"You can use Node.js modules in your application. Pick your favorite npm\nmodule. npm offers currently the world's biggest repository of open-source\ncode \u2013\xa0the ability to use well-maintained and tested code that used to be\nreserved for server applications is one of the key features of NodeGui.")),Object(r.b)("p",null,"As an example, to use the official AWS SDK in your application, you'd first\ninstall it as a dependency:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-sh"}),"npm install --save aws-sdk\n")),Object(r.b)("p",null,"Then, in your NodeGui app, require and use the module as if you were\nbuilding a Node.js application:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-javascript"}),'// A ready-to-use S3 Client\nconst S3 = require("aws-sdk/clients/s3");\n')),Object(r.b)("p",null,"There is one important caveat: Native Node.js modules (that is, modules that\nrequire compilation of native code before they can be used) will need to be\ncompiled with Qode or a compatible Node version to be used with NodeGui."),Object(r.b)("p",null,"The vast majority of Node.js modules are ",Object(r.b)("em",{parentName:"p"},"not")," native. Only 400 out of the\n~650.000 modules are native. However, if you do need native modules, please\nconsult ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"/docs/guides/using-native-node-modules"}),"this guide on how to recompile them for NodeGui"),"."))}d.isMDXComponent=!0},472:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return h}));var o=n(0),a=n.n(o);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),d=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=d(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=a.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=d(n),b=o,h=u["".concat(i,".").concat(b)]||u[b]||p[b]||r;return n?a.a.createElement(h,s(s({ref:t},l),{},{components:n})):a.a.createElement(h,s({ref:t},l))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=b;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);